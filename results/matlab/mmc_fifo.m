%  M/M/c FIFO WITH DEADLINES â€“ PLOTTING SCRIPT
%
%  This script reads the CSV file generated by mmc_fifo.java and
%  plots:
%     - Ns (sim vs theory)
%     - Nq (sim vs theory)
%     - Ds (sim vs theory)
%     - Dq (sim vs theory)
%     - Utilization
%     - Probability of serving expired tasks
%
%  Make sure the CSV file path matches your Java output.
% =============================================================

% clear; clc; close all;

% ======================
%  Load CSV
% =======================
csv_file = '../csv/mmc_fifo.csv';  
T = readtable(csv_file);

rho = T.rho;

Ns_sim = T.Ns_sim;   Ns_th = T.Ns_th;
Nq_sim = T.Nq_sim;   Nq_th = T.Nq_th;
Ds_sim = T.Ds_sim;   Ds_th = T.Ds_th;
Dq_sim = T.Dq_sim;   Dq_th = T.Dq_th;

util_sim = T.utilization_sim;
pExpired = T.pExpired_sim;

%% ======================
%  Helper plotting function
% =======================
function make_plot(x, y1, y2, ttl, ylab)
    figure; hold on; grid on;
    plot(x, y1, 'bo-', 'LineWidth', 1.6, 'MarkerSize', 6);
    if ~isempty(y2)
        plot(x, y2, 'r*-', 'LineWidth', 1.6, 'MarkerSize', 6);
        legend('Simulation', 'Theory', 'Location','best');
    else
        legend('Simulation', 'Location','best');
    end
    xlabel('\rho'); 
    ylabel(ylab);
    title(ttl);
end

%% ======================
%  PLOTS
% =======================

% ---- Ns ----
make_plot(rho, Ns_sim, Ns_th, 'Average Number in System (Ns)', 'Ns');

% ---- Nq ----
make_plot(rho, Nq_sim, Nq_th, 'Average Number in Queue (Nq)', 'Nq');

% ---- Ds ----
make_plot(rho, Ds_sim, Ds_th, 'Average System Delay (Ds)', 'Time');

% ---- Dq ----
make_plot(rho, Dq_sim, Dq_th, 'Average Queueing Delay (Dq)', 'Time');

% ---- Utilization ----
make_plot(rho, util_sim, [], 'Server Utilization', 'Utilization');

% ---- Probability of serving expired tasks ----
make_plot(rho, pExpired, [], 'P(Expired Task Served)', 'Probability');

disp('All plots generated successfully.');
